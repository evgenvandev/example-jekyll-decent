---
layout: post
title: "Применение библиотеки Gtk+ на C"
date: 2023-03-17 05:05:00 +0500
tags: Gtk+ C Programming
category: Gtk+
---

### Введение в Gtk+

GTK+ это библиотека для создания графических пользовательских интерфейсов. Библиотека создана на языке программирования C. GTK+ также называется набором инструментов GIMP. Первоначально библиотека была создана при разработке программы обработки изображений GIMP.   
С тех пор GTK+ стал одним из самых популярных наборов инструментов для Linux и BSD Unix. Сегодня большая часть программного обеспечения с графическим интерфейсом в мире с открытым исходным кодом создается в Qt или GTK+.   
GTK+ — это объектно-ориентированный интерфейс прикладного программирования. Объектно-ориентированная система создается с помощью системы Glib Object, которая является основой для библиотеки GTK+. GObject также позволяет создавать языковые привязки для различных других языков программирования. Существуют языковые привязки для C++, Python, Perl, Java, C# и других языков программирования.

Сам GTK+ зависит от следующих библиотек:

- Glib
- Pango
- ATK
- GDK
- GdkPixbuf
- Cairo

где:
- Glib — это служебная библиотека общего назначения. Она предоставляет различные типы данных, строковые утилиты, включает отчеты об ошибках, регистрацию сообщений, работу с потоками и другие полезные функции программирования.   
- Pango — это библиотека, которая обеспечивает интернационализацию.   
- ATK — набор инструментов доступности; он предоставляет инструменты, которые помогают людям с ограниченными физическими возможностями работать с компьютерами.   
- GDK представляет собой оболочку низкоуровневых функций рисования и работы с окнами, предоставляемых базовой графической системой. В Linux GDK находится между X-сервером и библиотекой GTK+. Он обрабатывает базовый рендеринг, такой как рисование примитивов, растровая графика, курсоры, шрифты, а также события окна и функции перетаскивания.   
- Библиотека GdkPixbuf — это набор инструментов для загрузки изображений и работы с пиксельным буфером.   
- Cairo — это библиотека для создания 2D-векторной графики. Он был включен в GTK+ начиная с версии 2.8. 

Среды рабочего стола Gnome и XFce были созданы с использованием библиотеки GTK+. SWT и wxWidgets — хорошо известные среды программирования, использующие GTK+. Известные программные приложения, использующие GTK+ это Firefox или Inkscape.

### Установка библиотеки Gtk+

### Компиляция приложений Gtk+

Для компиляции приложений GTK+ у нас есть удобный инструмент под названием `pkg-config`. `pgk-config` возвращает метаданные об установленных библиотеках. Если мы хотим использовать определенную библиотеку, программа `pkg-config` предоставит нам необходимые зависимые библиотеки и включит нужные нам файлы. Программа pkg-config извлекает информацию о пакетах из специальных файлов метаданных (расширение файлов `.pc`) 

Следующей командой:

```bash
pkg-config --cflags --libs gtk+-3.0
```

где: 
- `--cflags` - данный параметр выводит флаги препроцессора и компиляции, необходимые для компиляции программ GTK+, включая флаги для всех их зависимостей;
- `--libs` - данный параметр перечисляет необходимые библиотеки.

мы получаем вывод ссылок на заголовочные файлы (расширение `.h`) необходимых библиотек, на необходимые статические библиотеки (название файла начинается `lib...` и расширение `.a`), все они необходимы для компиляции программ, использующих библиотеку Gtk+: 

```bash
-mms-bitfields -Ic:/gtk/include/gtk-3.0 -Ic:/gtk/include/cairo -Ic:/gtk/include/pango-1.0 -Ic:/gtk/include/atk-1.0 -Ic:/gtk/include/cairo -Ic:/gtk/include/pixman-1 -Ic:/gtk/include -I/srv/win32builder/fixed_3104/build/win64/include/freetype2 -I/srv/win32builder/fixed_3104/build/win64/include/libxml2 -Ic:/gtk/include/libxml2 -I/srv/win32builder/fixed_3104/build/win64/include/freetype2 -Ic:/gtk/include/libpng16 -Ic:/gtk/include/gdk-pixbuf-2.0 -Ic:/gtk/include/libpng16 -Ic:/gtk/include/glib-2.0 -Ic:/gtk/lib/glib-2.0/include -Lc:/gtk/lib -lgtk-3 -lgdk-3 -lgdi32 -limm32 -lshell32 -lole32 -Wl,-luuid -lwinmm -lz -lpangocairo-1.0 -lpangowin32-1.0 -lgdi32 -lpango-1.0 -lm -latk-1.0 -lcairo-gobject -lcairo -lgdk_pixbuf-2.0 -lgio-2.0 -lgobject-2.0 -lglib-2.0 -lintl
```

![Вывод программы-утилиты pkg-config]({{ "/media/img/gtk+/pkg-config_--cflags_--libs_gtk+-3.0_output.jpg" | absolute_url }} "Вывод программы-утилиты pkg-config")

Теперь, например, для компиляции программы на языке `C`, `simple.c`, использующей библиотеку Gtk+, необходимо ввести в командной строке Windows (`cmd.exe`) следующую команду:

```bash
gcc simple.c -o simple -mwindows -mms-bitfields -Ic:/gtk/include/gtk-3.0 -Ic:/gtk/include/cairo -Ic:/gtk/include/pango-1.0 -Ic:/gtk/include/atk-1.0 -Ic:/gtk/include/cairo -Ic:/gtk/include/pixman-1 -Ic:/gtk/include -I/srv/win32builder/fixed_3104/build/win64/include/freetype2 -I/srv/win32builder/fixed_3104/build/win64/include/libxml2 -Ic:/gtk/include/libxml2 -I/srv/win32builder/fixed_3104/build/win64/include/freetype2 -Ic:/gtk/include/libpng16 -Ic:/gtk/include/gdk-pixbuf-2.0 -Ic:/gtk/include/libpng16 -Ic:/gtk/include/glib-2.0 -Ic:/gtk/lib/glib-2.0/include -Lc:/gtk/lib -lgtk-3 -lgdk-3 -lgdi32 -limm32 -lshell32 -lole32 -Wl,-luuid -lwinmm -lz -lpangocairo-1.0 -lpangowin32-1.0 -lgdi32 -lpango-1.0 -lm -latk-1.0 -lcairo-gobject -lcairo -lgdk_pixbuf-2.0 -lgio-2.0 -lgobject-2.0 -lglib-2.0 -lintl
```

где:
- `gcc` - вызов программы компилятора языка C;
- `simple.c` - файл с исходным кодом программы;
- `-o simple` - флаг, который указывает компилятору, как назвать выходной файл с расширением exe;
- `-mwindows` - флаг, который указывает, что создаётся графическое приложение windows;
- `-mms-bitfields -Ic:/gtk/include/gtk-3.0 -Ic ... -lglib-2.0 -lintl` - это вывод программы `pkg-config` для библиотеки Gtk+, он содержит ссылки на заголовочные файлы (расширение `.h`) необходимых библиотек, на необходимые статические библиотеки (название файла начинается `lib...` и расширение `.a`).   
Данный вывод настраивается под каждую операционную систему, где осуществляется компиляция программы с использованием библиотеки Gtk+.

### Первая программа 

Следующая программа печатает версии библиотек GTK+ и Glib.

Файл _`version.c`_

<pre class="line-numbers language-c"><code>/*
https://zetcode.com/gui/gtk2/introduction/
Version
Версия
*/
#include &lt;gtk/gtk.h&gt;
#include &lt;conio.h&gt;  // Включает функцию getch()

int main(int argc, char *argv[]) {
	
	gtk_init(&amp;argc, &amp;argv);
	
	g_printf(&quot;GTK+ version: %d.%d.%d\n&quot;, gtk_major_version, gtk_minor_version, 
			gtk_micro_version);
	g_printf(&quot;Glib version: %d.%d.%d\n&quot;, glib_major_version, glib_minor_version, 
			glib_micro_version);
	
	// Программа ждёт нажатия клавиши от пользователя
	getch();
	
	return 0;
}
</code></pre>

Компилируем программу `version.c` командой:

```bash
gcc version.c -o version -mms-bitfields -Ic:/gtk/include/gtk-3.0 -Ic:/gtk/include/cairo -Ic:/gtk/include/pango-1.0 -Ic:/gtk/include/atk-1.0 -Ic:/gtk/include/cairo -Ic:/gtk/include/pixman-1 -Ic:/gtk/include -I/srv/win32builder/fixed_3104/build/win64/include/freetype2 -I/srv/win32builder/fixed_3104/build/win64/include/libxml2 -Ic:/gtk/include/libxml2 -I/srv/win32builder/fixed_3104/build/win64/include/freetype2 -Ic:/gtk/include/libpng16 -Ic:/gtk/include/gdk-pixbuf-2.0 -Ic:/gtk/include/libpng16 -Ic:/gtk/include/glib-2.0 -Ic:/gtk/lib/glib-2.0/include -Lc:/gtk/lib -lgtk-3 -lgdk-3 -lgdi32 -limm32 -lshell32 -lole32 -Wl,-luuid -lwinmm -lz -lpangocairo-1.0 -lpangowin32-1.0 -lgdi32 -lpango-1.0 -lm -latk-1.0 -lcairo-gobject -lcairo -lgdk_pixbuf-2.0 -lgio-2.0 -lgobject-2.0 -lglib-2.0 -lintl
```

В данной команде нет флага `-mwindows`, так как мы не создаём графическое приложение, а выводим результат в консоль windows.   
Запускаем сгенерированный файл `version.c`.   
Получаем следующий результат: 

![Версии библиотек Gtk+ и Glib, вывод в консоли]({{ "/media/img/gtk+/programm_version.jpg" | absolute_url }} "Версии библиотек Gtk+ и Glib, вывод в консоли")

Программа использует встроенные константы.

### Первые программы на Gtk+

Мы постепенно создадим программу, которая:

1. Показывает основное окно;
1. Центрирует окно на экране;
1. Показывает значок в строке заголовка;
1. Отображает небольшую всплывающую подсказку;
1. Создаст мнемонику для виджета кнопки.

#### 1. Показываем основное окно

Первая программа показывает основное окно.

Файл _`simple.c`_

<pre class="line-numbers language-c"><code>/*
https://zetcode.com/gui/gtk2/firstprograms/
Simple example
Простой пример
*/
#include &lt;gtk/gtk.h&gt;

int main(int argc, char *argv[]) {
	
	GtkWidget *window;
	
	gtk_init(&amp;argc, &amp;argv);
	
	window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
	gtk_widget_show(window);
	
	g_signal_connect(window, &quot;destroy&quot;, G_CALLBACK(gtk_main_quit), NULL);
	
	gtk_main();
	
	return 0;
}
</code></pre>

В этом примере показано основное окно на экране.

```c
GtkWidget *window;
```

`GtkWidget` — это базовый класс, от которого наследуются все виджеты в GTK+. Он управляет жизненным циклом, состояниями и стилем виджета.

```c
gtk_init(&argc, &argv);
```

Функция `gtk_init` инициализирует GTK+ и разбирает (анализирует) некоторые стандартные параметры командной строки. Эта функция должна быть вызвана перед использованием любых других функций GTK+.

```c
window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
```

Функция `gtk_window_new` создает новое `GtkWindow`, окно верхнего уровня, которое может содержать другие виджеты. Тип окна — `GTK_WINDOW_TOPLEVEL`; окна верхнего уровня имеют заголовок и рамку. Ими управляет оконный менеджер.

```c
gtk_widget_show(window);
```

`gtk_widget_show` помечает виджет для отображения. Любой виджет, который не отображается, не будет отображаться на экране.

```c
g_signal_connect(window, "destroy",
    G_CALLBACK(gtk_main_quit), NULL);
```

Функция `g_signal_connect` соединяет функцию обратного вызова с сигналом для конкретного объекта. По умолчанию окно не реагирует на сигнал уничтожения. Мы должны явно завершить приложение, подключив сигнал уничтожения к встроенной функции `gtk_main_quit`, которая завершает приложение.

```c
gtk_main();
```

Этот код входит в основной цикл GTK+. С этого момента приложение сидит и ждет, когда произойдут события.

Следующей командой мы компилируем пример: 

```bash
gcc simple.c -o simple -mwindows -mms-bitfields -Ic:/gtk/include/gtk-3.0 -Ic:/gtk/include/cairo -Ic:/gtk/include/pango-1.0 -Ic:/gtk/include/atk-1.0 -Ic:/gtk/include/cairo -Ic:/gtk/include/pixman-1 -Ic:/gtk/include -I/srv/win32builder/fixed_3104/build/win64/include/freetype2 -I/srv/win32builder/fixed_3104/build/win64/include/libxml2 -Ic:/gtk/include/libxml2 -I/srv/win32builder/fixed_3104/build/win64/include/freetype2 -Ic:/gtk/include/libpng16 -Ic:/gtk/include/gdk-pixbuf-2.0 -Ic:/gtk/include/libpng16 -Ic:/gtk/include/glib-2.0 -Ic:/gtk/lib/glib-2.0/include -Lc:/gtk/lib -lgtk-3 -lgdk-3 -lgdi32 -limm32 -lshell32 -lole32 -Wl,-luuid -lwinmm -lz -lpangocairo-1.0 -lpangowin32-1.0 -lgdi32 -lpango-1.0 -lm -latk-1.0 -lcairo-gobject -lcairo -lgdk_pixbuf-2.0 -lgio-2.0 -lgobject-2.0 -lglib-2.0 -lintl
```

где:
- `gcc` - вызов программы компилятора языка C;
- `simple.c` - файл с исходным кодом программы;
- `-o simple` - флаг, который указывает компилятору, как назвать выходной файл с расширением exe;
- `-mwindows` - флаг, который указывает, что создаётся графическое приложение windows;
- `-mms-bitfields -Ic:/gtk/include/gtk-3.0 -Ic ... -lglib-2.0 -lintl` - это вывод программы `pkg-config` для библиотеки Gtk+, он содержит ссылки на заголовочные файлы (расширение `.h`) необходимых библиотек, на необходимые статические библиотеки (название файла начинается `lib...` и расширение `.a`).   
Данный вывод настраивается под каждую операционную систему, где осуществляется компиляция программы с использованием библиотеки Gtk+.

![Простая программа на C с использованием Gtk+]({{ "/media/img/gtk+/simple_example-1.jpg#right" | absolute_url }} "Простая программа на C с использованием Gtk+")

Запускаем файл `simple.exe`. Появится окно программы `simple.exe`.